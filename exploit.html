<!DOCTYPE html>
<html>
<head>
    <title>AutoJWT</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://kit.fontawesome.com/83ca99a678.js" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        .copy-icon {
            color: #a4c6eb;
            cursor: pointer;
			margin-left: 5px;
			margin-right: 5px;
        }
        body {
            background-color: #f8f9fa;
        }
        .container {
            padding-top: 50px;
        }
        .card {
            border-radius: 20px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            transition: 0.3s;
            margin-bottom: 30px;
            background-color: #fff;
        }
        .card-title {
            color: #007bff;
            font-size: 20px;
            font-weight: bold;
        }
        .card-body {
            padding: 20px;
        }
        .card-text {
            font-size: 16px;
            max-height: 200px;
            overflow-y: auto;
        }
        pre {
            border: 2px solid #dddddd; /* 테두리 스타일 설정 */
            padding: 10px; /* 내부 패딩 설정 */
            border-radius: 5px; /* 테두리의 모서리를 둥글게 만듭니다. */
            height: 100%;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 60%;
            height: 60%;
			position: relative;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
			position: absolute; top: 10px; right: 20px;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #code_iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .styled-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
	
	<a href="/">
		<img src="{{ url_for('static', filename='images/logo2.png') }}" alt="Logo Image" style="max-width: 300px;">
	</a>
	<a href="https://jiniway-study-note.notion.site/Jwt-token-1dfdd8d08917428baa752cfddd753316?pvs=74" target="_blank" class="styled-button"><i class="fa-solid fa-arrow-up-right-from-square"></i>  Let's Study</a>

    <div class="container">
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Exploit 1: None Algorithm</h5>
						<b>token. </b>
						<span class="copy-icon" onclick="copyTextareaContent('exploit1')">
							<i class="fa-regular fa-copy"></i>
						</span>
                        <p class="card-text" id="exploit1" hidden>{{ tokens[0] }}</p>
						<pre class="text">{{ decoded_tokens[0] }}</pre>
						<button class="btn btn-secondary" onclick="openCode(1)">View Code</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Exploit 2: Unverified Signature</h5>
						<b>token. </b>
						<span class="copy-icon" onclick="copyTextareaContent('exploit2')">
							<i class="fa-regular fa-copy"></i>
						</span>
                        <p class="card-text" id="exploit2" hidden>{{ tokens[1] }}</p>
						<pre class="text">{{ decoded_tokens[1] }}</pre>
						<button class="btn btn-secondary" onclick="openCode(2)">View Code</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Exploit 3: Crack secret key</h5>
						<button class="btn btn-primary" id="exploit3-button">Run Exploit 3</button>
						<div id="ex3_progressBar"></div>
						<b id="ex3_error-message" style="color:red"></b><br>
						
						<b>cracked secret: </b>
						<b class="card-text" id="exploit3_secret" style="color: #F03346;"></b>
						<span class="copy-icon" onclick="copyTextareaContent('exploit3')">
							<i class="fa-regular fa-copy"></i>
						</span>
						<p class="card-text" id="exploit3" hidden></p>
						<pre class="text" id="exploit3_decoded"></pre>
						
						<button class="btn btn-secondary" onclick="openCode(3)">View Code</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Exploit 4: token header injection</h5>
						<b>4-1. jwk header injection</b>
						<span class="copy-icon" onclick="copyTextareaContent('exploit4_token1')">
							<i class="fa-regular fa-copy"></i>
						</span>
                        <p class="card-text" id="exploit4_token1" hidden>{{ tokens[2] }}</p><br>
						<pre class="text">{{ decoded_tokens[2] }}</pre>
						
						<b>4-2. jku header injection</b>
						<span class="copy-icon" onclick="copyTextareaContent('exploit4_token2')">
							<i class="fa-regular fa-copy"></i>
						</span>
                        <p class="card-text" id="exploit4_token2" hidden>{{ tokens[3] }}</p><br>
						<pre class="text">{{ decoded_tokens[3] }}</pre>
						
						<b>4-3. kid header injection</b>
						<span class="copy-icon" onclick="copyTextareaContent('exploit4_token3')">
							<i class="fa-regular fa-copy"></i>
						</span>
                        <p class="card-text" id="exploit4_token3" hidden>{{ tokens[4] }}</p><br>
						<pre class="text">{{ decoded_tokens[4] }}</pre>

						<button class="btn btn-secondary" onclick="openCode(4)">View Code</button>
                    </div>
                </div>
            </div>
			<div class="col-md-4 mb-3">
				<div class="card">
					<div class="card-body">
						<h5 class="card-title">Exploit 5: Algorithm Confusion</h5>
						<button class="btn btn-primary" id="exploit5-button" >Run Exploit 5</button>
						<div id="progressBar"></div>
						<b id="error-message" style="color:red" style="display: none;"></b><br>
						
						<div class="mb-3">
							<b>token1. x509</b>
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token1')">
								<i class="fa-regular fa-copy"></i>
							</span>
							<p class="card-text" id="exploit5_token1" hidden></p><br>
							<pre class="text" id="exploit5_1_decoded"></pre>
							<b>exploit-token1. x509</b>
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token11')">
									<i class="fa-regular fa-copy"></i>
							</span>
							<p class="card-text" id="exploit5_token11" hidden></p><br>
							<pre class="text" id="exploit5_11_decoded"></pre>
						</div>
						<div class="mb-3">
							<b>token2. PKCS</b>
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token2')">
								<i class="fa-regular fa-copy"></i>
							</span>
							<p class="card-text" id="exploit5_token2" hidden></p><br>
							<pre class="text" id="exploit5_2_decoded"></pre>
							<b>exploit-token2. PKCS</b>
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token22')">
								<i class="fa-regular fa-copy"></i>
						</span>
							<p class="card-text" id="exploit5_token22" hidden></p><br>
							<pre class="text" id="exploit5_22_decoded"></pre>
						</div>
						<div class="mb-3">
							<b>token3. x509</b>
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token3')">
								<i class="fa-regular fa-copy"></i>
							</span>
							<p class="card-text" id="exploit5_token3" hidden></p><br>
							<pre class="text" id="exploit5_3_decoded"></pre>
							<b>exploit-token3. x509</b> 
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token33')">
									<i class="fa-regular fa-copy"></i>
							</span>
							<p class="card-text" id="exploit5_token33" hidden></p><br>
							<pre class="text" id="exploit5_33_decoded"></pre>
						</div>
						<div class="mb-3">
							<b>token4. PKCS</b>
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token4')">
								<i class="fa-regular fa-copy"></i>
							</span>
							<p class="card-text" id="exploit5_token4" hidden></p><br>
							<pre class="text" id="exploit5_4_decoded"></pre>
							<b>exploit-token4. PKCS</b>
							<span class="copy-icon" onclick="copyTextareaContent('exploit5_token44')">
								<i class="fa-regular fa-copy"></i>
							</span>
							<p class="card-text" id="exploit5_token44" hidden></p><br>
							<pre class="text" id="exploit5_44_decoded"></pre>
						</div>
						
						<button class="btn btn-secondary" onclick="openCode(5)">View Code</button>
					</div>
				</div>
			</div>
			<div class="col-md-12 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Token List</h5>
						<b>Exploit1.</b> 
						<pre class="text">{{ tokens[0] }}</pre>
						<b>Exploit2.</b> 
						<pre class="text">{{ tokens[1] }}</pre>
						<b>Exploit3.</b> 
						<pre class="text" id="exploit3_repeat"></pre>
						<b>Exploit4-1.</b> 
						<pre class="text">{{ tokens[2] }}</pre>
						<b>Exploit4-2.</b> 
						<pre class="text">{{ tokens[3] }}</pre>
						<b>Exploit4-3.</b> 
						<pre class="text">{{ tokens[4] }}</pre>
						<b>Exploit5-1.</b> 
						<pre class="text" id="exploit5_repeat11" ></pre>
						<b>Exploit5-2.</b> 
						<pre class="text" id="exploit5_repeat22" ></pre>
						<b>Exploit5-3.</b> 
						<pre class="text" id="exploit5_repeat33" ></pre>
						<b>Exploit5-4.</b> 
						<pre class="text" id="exploit5_repeat44" ></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

	<div id="codeView" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCode()">&times;</span>
			<iframe id="code_iframe"></iframe>
        </div>
    </div>

	<script>
        $(document).ready(function(){
			$('#exploit3-button').click(function(){
				$('#ex3_progressBar').html('<progress id="ex3_progress" max="100" value="0"></progress>');
				var progressBar = document.getElementById("ex3_progress");
				var currentValue = 0;
				
				var interval = setInterval(function() {
					currentValue += 2; 
					if (currentValue >= 100) {
						clearInterval(interval);
					} else {
						progressBar.value = currentValue;
					}
				}, 1000); 
			
                $.ajax({
                    type: "POST",
                    url: "/exploit3",
                    success: function(response){
						clearInterval(interval); 
						$('#ex3_progressBar').empty();
						
						result = response.result;
						if (result){
							ex3_token = response.ex3_token;
							ex3_decoded = response.ex3_decoded;
							ex3_secret = response.secret;
							$('#exploit3').text(ex3_token);
							$('#exploit3_decoded').text(ex3_decoded);
							$('#exploit3_secret').text(ex3_secret);
							$('#exploit3_repeat').text(ex3_token);
						}
						
						else{
							$('#ex3_error-message').text('* Working only HS256');
						}
                    },
                    error: function(xhr, status, error){
						clearInterval(interval);
						$('#ex3_progressBar').empty(); 
					}
                });
            });

            $('#exploit5-button').click(function(){
				$('#progressBar').html('<progress id="progress" max="100" value="0"></progress>');
				var progressBar = document.getElementById("progress");
				var currentValue = 0;
				
				var interval = setInterval(function() {
					currentValue += 2; 
					if (currentValue >= 100) {
						clearInterval(interval);
					} else {
						progressBar.value = currentValue;
					}
				}, 1000); 
			
                $.ajax({
                    type: "POST",
                    url: "/exploit5",
                    success: function(response){
						clearInterval(interval); 
						$('#progressBar').empty();
						
						result = response.result;
			    			error = response.error;
						if (result){
							ex5_tokens1 = response.ex5_tokens1;
							ex5_tokens2 = response.ex5_tokens2;
							ex5_decoded = response.ex5_decoded;
							$('#exploit5_token1').text(ex5_tokens1[0]);
							$('#exploit5_token2').text(ex5_tokens1[1]);
							$('#exploit5_token3').text(ex5_tokens1[2]);
							$('#exploit5_token4').text(ex5_tokens1[3]);

							$('#exploit5_token11').text(ex5_tokens2[0]);
							$('#exploit5_token22').text(ex5_tokens2[1]);
							$('#exploit5_token33').text(ex5_tokens2[2]);
							$('#exploit5_token44').text(ex5_tokens2[3]);

							$('#exploit5_1_decoded').text(ex5_decoded[0]);
							$('#exploit5_11_decoded').text(ex5_decoded[1]);
							$('#exploit5_2_decoded').text(ex5_decoded[2]);
							$('#exploit5_22_decoded').text(ex5_decoded[3]);
							$('#exploit5_3_decoded').text(ex5_decoded[4]);
							$('#exploit5_33_decoded').text(ex5_decoded[5]);
							$('#exploit5_4_decoded').text(ex5_decoded[6]);
							$('#exploit5_44_decoded').text(ex5_decoded[7]);

							$('#exploit5_repeat11').text(ex5_tokens2[0]);
							$('#exploit5_repeat22').text(ex5_tokens2[1]);
							$('#exploit5_repeat33').text(ex5_tokens2[2]);
							$('#exploit5_repeat44').text(ex5_tokens2[3]);
						}
						
						else{
							$('#error-message').text('* '+error);
						}
                    },
                    error: function(xhr, status, error){
						clearInterval(interval);
						$('#progressBar').empty(); 
					}
                });
            });
        });
		
		function copyTextareaContent(id) {
			// id에 해당하는 요소의 내용을 선택합니다.
			var text = document.getElementById(id).innerText;

			// 임시 textarea 요소를 생성하고 텍스트를 복사합니다.
			var tempTextarea = document.createElement("textarea");
			tempTextarea.value = text;

			// textarea를 화면 바깥으로 이동하여 텍스트를 복사합니다.
			tempTextarea.style.position = "absolute";
			tempTextarea.style.left = "-9999px";
			document.body.appendChild(tempTextarea);

			// 텍스트를 선택하고 클립보드에 복사합니다.
			tempTextarea.select();
			document.execCommand("copy");
			
			// 임시 textarea를 제거합니다.
			document.body.removeChild(tempTextarea);
			alert(id+' 복사완료');
		}
		
        function openCode(id) {
            document.getElementById("codeView").style.display = "block";
			document.getElementById("code_iframe").src = "viewCode?id=" + id;
        }

        function closeCode() {
            document.getElementById("codeView").style.display = "none";
        }
    </script>
</body>
</html>
